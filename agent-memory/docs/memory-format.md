# Memory File Format Specification

## Overview

All memory files are plain Markdown with YAML frontmatter. This format is:
- Readable in any text editor
- Native to Obsidian (frontmatter, tags, wikilinks)
- Parseable by the SDK (gray-matter library)
- Version-controllable with git

## Frontmatter Schema

Every memory file includes YAML frontmatter between `---` fences:

```yaml
---
date: "2026-02-14"              # ISO 8601 date
session_id: "abc123"            # Optional: session identifier
source: "claude-code"           # Origin: claude-code, hook, manual
slug: "api-design-review"       # Descriptive topic slug
type: "daily-log"               # One of: daily-log, memory-flush, session-save, curated
tags:                           # Obsidian-compatible tags
  - memory/daily
  - session/claude-code
  - project/agent-os
links:                          # Optional: wikilinks to related entries
  - "[[memory/2026-02-13-setup]]"
---
```

### Required Fields

| Field | Type | Description |
|-------|------|-------------|
| `date` | string | ISO 8601 date (YYYY-MM-DD) |
| `tags` | string[] | At least one tag for categorization |

### Optional Fields

| Field | Type | Description |
|-------|------|-------------|
| `session_id` | string | Session identifier |
| `source` | string | How the entry was created |
| `slug` | string | Topic description |
| `type` | string | Entry type (see below) |
| `links` | string[] | Wikilinks to related entries |

## File Types

### `daily-log` — Daily Memory Logs

**Location**: `memory/YYYY-MM-DD-slug.md`

```markdown
---
date: "2026-02-14"
session_id: "sess_abc123"
source: "claude-code"
slug: "api-design-review"
type: daily-log
tags:
  - memory/daily
  - session/claude-code
---

# Session: 2026-02-14 14:30:00 UTC

- **Session ID**: sess_abc123
- **Source**: claude-code
- **Topic**: api-design-review

## Context

Working on the API endpoint design for the user authentication flow.

## Key Points

- Decided to use JWT tokens with 15-minute expiry
- Refresh tokens stored in httpOnly cookies
- Rate limiting: 100 requests per minute per user

## Decisions Made

- Use bcrypt for password hashing (cost factor 12)
- OAuth2 support deferred to v2

## Action Items

- [ ] Implement token refresh endpoint
- [ ] Add rate limiting middleware
```

### `memory-flush` — Pre-Compaction Saves

**Location**: `memory/YYYY-MM-DD-flush-HHMMSS.md`

```markdown
---
date: "2026-02-14"
type: memory-flush
source: auto-compaction
tags:
  - memory/flush
  - memory/auto
---

# Memory Flush: 2026-02-14 143022 UTC

> Auto-saved before context compaction.

## Session Summary

Was implementing the authentication middleware. User prefers minimal
dependencies — chose jose over jsonwebtoken.

## Important Context to Preserve

- Auth middleware is in src/middleware/auth.ts
- Tests are passing but need edge case coverage
- User's API key is stored in .env (ANTHROPIC_API_KEY)

## Pending Work

- Token refresh endpoint still needs implementation
- Need to add rate limiting after auth is complete
```

### `session-save` — Session End Saves

**Location**: `memory/YYYY-MM-DD-slug.md`

```markdown
---
date: "2026-02-14"
session_id: "sess_def456"
source: "claude-code"
type: session-save
tags:
  - memory/session
  - session/claude-code
---

# Session Save: auth-middleware

> Saved on session end.

## Conversation Summary

Implemented JWT authentication middleware with refresh token support.
All tests passing. Ready for code review.

## Key Takeaways

- Auth middleware complete in src/middleware/auth.ts
- 15-minute access tokens, 7-day refresh tokens
- Tests in test/middleware/auth.test.ts (12 tests, all passing)
```

### `curated` — Long-Term Memory (MEMORY.md)

**Location**: `MEMORY.md` (vault root)

```markdown
---
type: memory
scope: long-term
updated: "2026-02-14"
tags:
  - memory/curated
  - agent/core
---

# Agent Memory

## User Preferences

- Prefers TypeScript over JavaScript
- Likes minimal dependencies
- Communication style: direct, technical
- Working hours: 9am-6pm EST

## Key Decisions

- Auth: JWT with 15-min expiry, refresh tokens in httpOnly cookies
- Database: PostgreSQL with Drizzle ORM
- Testing: Vitest with V8 coverage

## Project Context

- **Current project**: Agent OS Memory System
- **Stack**: Obsidian, Claude Code, Claude Agent SDK, Markdown
- **Status**: In development, core architecture complete
```

## Naming Conventions

### File Names

- Daily logs: `YYYY-MM-DD-slug.md`
- Memory flushes: `YYYY-MM-DD-flush-HHMMSS.md`
- Session saves: `YYYY-MM-DD-slug.md`

### Slugs

- Lowercase, hyphen-separated
- 2-5 words describing the topic
- Generated by Claude or fallback to timestamp
- Examples: `api-design-review`, `bug-fix-auth`, `project-planning`

### Tags

Hierarchical tag system using `/` separator:

| Tag | Description |
|-----|-------------|
| `memory/daily` | Daily log entries |
| `memory/flush` | Auto-compaction flushes |
| `memory/session` | Session-end saves |
| `memory/curated` | Long-term curated memory |
| `memory/auto` | Auto-generated entries |
| `memory/stale` | Possibly outdated entries |
| `session/claude-code` | Created via Claude Code |
| `session/manual` | Manually created |
| `agent/core` | Core agent files |
| `agent/instructions` | Operating instructions |
| `agent/persona` | Persona files |

## Wikilinks

Use Obsidian wikilinks to cross-reference memory entries:

```markdown
Related to our earlier discussion in [[memory/2026-02-13-api-design]].

See also: [[MEMORY#Key Decisions]]
```
